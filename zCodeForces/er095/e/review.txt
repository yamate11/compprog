Educational Codeforces Round 95-E Expected Damage
2020/09/26
解けず
確率

長さNの整数列DとM個のクエリ(A_i, B_i) が与えられる．
各クエリでは，
Dのランダムシャッフルが与えられたときに，DのB_i以上の要素のうち
前からA_i番目のものの位置を D_d として，Σ{ D_x | d < x < N} の期待値を
求める．
N, M <= 2e5; D_i <= 1e9, A_1 <= N, B_i <= 1e9

B_i 以上の要素の集合を Big, B_i未満の要素の集合を Small とする．
|Big| を T と書く．
T < a なら期待値は0．そうでないとする．
キーとなる命題:
(1) Big の各要素が和に参加する確率は (T - a) / T.
(2) Small の各要素が和に参加する確率は (T + 1 - a) / (T + 1)

(1)の証明: Bigの全順列を考えれば，各要素が d 番目以降に位置する確率はみな同じ．
(2)の証明: Dの順列をとる．Bigの要素のs番目とs+1番目に挟まれる Small の要素
の並びと，Bigの要素のs+1番目とs+2番目に挟まれる Small の要素の並びを
swap するというオペレーションは，Dの順列上の 1-1 onto 写像．つまり，Small
の各要素がBigの要素で分割したどのパートに入る確率もみな同じ．

